<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mood Classifier ‚Äî Web Starter (TF.js + Teachable Machine)</title>
  <!-- Accessibility: readable default fonts and high-contrast base -->
  <style>
    :root{--gap:12px;--radius:16px;--shadow:0 6px 20px rgba(0,0,0,.08)}
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Noto Sans,Apple SD Gothic Neo,Pretendard,sans-serif;margin:0;background:#f7f7fb;color:#111}
    header{padding:20px 16px;text-align:center}
    h1{font-size:22px;margin:0 0 4px}
    main{max-width:920px;margin:0 auto;padding:0 16px 48px}
    .grid{display:grid;grid-template-columns:1fr;gap:var(--gap)}
    @media(min-width:960px){.grid{grid-template-columns:360px 1fr}}
    .card{background:#fff;border-radius:var(--radius);box-shadow:var(--shadow);padding:16px}
    .row{display:flex;gap:var(--gap);align-items:center;flex-wrap:wrap}
    button,input[type=file]{padding:10px 14px;border-radius:10px;border:1px solid #ddd;background:#fff;cursor:pointer}
    button:focus, input:focus, select:focus{outline:3px solid #70a6ff44}
    .primary{background:#111;color:#fff;border-color:#111}
    .muted{color:#666}
    .hidden{display:none}
    .preview{width:100%;aspect-ratio:4/3;border-radius:12px;object-fit:cover;background:#eee}
    .log{font-family:ui-monospace,Consolas,monospace;background:#0b1020;color:#e5ecff;border-radius:12px;padding:12px;overflow:auto}
    .badge{display:inline-block;padding:4px 8px;border-radius:999px;background:#eef;}
    progress{width:100%;height:16px}
    .error{background:#fff0f0;border:1px solid #ffd7d7;color:#820000;padding:10px 12px;border-radius:12px}
    .good{background:#f0fff4;border:1px solid #d4f5dc;color:#004a1f;padding:10px 12px;border-radius:12px}
    .kbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    kbd{background:#f0f0f0;border:1px solid #ddd;border-bottom-width:2px;border-radius:6px;padding:2px 6px;font-family:ui-monospace,Consolas,monospace}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
  </style>
  <!-- Teachable Machine Image library & TensorFlow.js -->
  <script src="https://cdn.jsdelivr/npm/@tensorflow/tfjs@4.21.0/dist/tf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/teachablemachine-image/0.8.0/teachablemachine-image.min.js"></script>
</head>
<body>
  <header>
    <h1 aria-label="Mood classifier web starter">üòé Mood Classifier ‚Äî Web Starter</h1>
    <p class="muted">Input ‚Üí inference ‚Üí feedback ‚Üí action ¬∑ Shows top-K labels and probabilities ¬∑ Gives guidance when confidence is low.</p>
  </header>

  <main class="grid" id="app">
    <!-- Controls & Preview -->
    <section class="card" aria-labelledby="controls-title">
      <h2 id="controls-title">1) Input & Controls</h2>
      <p class="muted">Use either your camera or an image file. You can also control everything with the keyboard.</p>

      <div class="row kbar" aria-label="Keyboard shortcuts">
        <span class="badge">Shortcuts</span>
        <span><kbd>C</kbd> toggle camera</span>
        <span><kbd>U</kbd> upload file</span>
        <span><kbd>R</kbd> reset</span>
      </div>

      <div class="row" style="margin-top:8px">
        <button id="btnCam" class="primary" aria-pressed="false" aria-controls="video" title="Use camera" disabled>Start Camera</button>
        <label for="file" class="sr-only">Upload image</label>
        <input id="file" type="file" accept="image/*" title="Upload image file" />
        <button id="btnReset" title="Reset preview">Reset</button>
      </div>

      <div style="margin-top:12px" class="row">
        <video id="video" class="preview hidden" playsinline muted aria-label="Camera preview"></video>
        <img id="img" class="preview hidden" alt="Uploaded image preview" />
        <canvas id="canvas" class="preview hidden" aria-hidden="true"></canvas>
      </div>

      <div id="status" class="muted" style="margin-top:8px">Idle‚Ä¶</div>
      <div id="msg" class="hidden" role="status" aria-live="polite" style="margin-top:8px"></div>
    </section>

    <!-- Predictions & Guidance -->
    <section class="card" aria-labelledby="pred-title" id="pred-section">
      <h2 id="pred-title">2) Prediction Results</h2>
      <p class="muted">Shows the top-K labels and probabilities. Provides guidance when confidence is low.</p>

      <div id="progressBox" class="hidden" style="margin-bottom:8px">
        <label for="progress" class="muted">Loading model</label>
        <progress id="progress" max="100" value="0"></progress>
      </div>

      <div id="predictions" class="log" style="min-height:140px" aria-live="polite" aria-atomic="true">Waiting for results‚Ä¶</div>
      <div id="guidance" class="muted" style="margin-top:10px"></div>
      <div class="row" style="margin-top:10px">
        <button id="btnNextWeather" class="primary" disabled>Next: Choose Weather</button>
      </div>

      <div class="row" style="margin-top:8px">
        <span class="badge">Manual selection</span>
        <button data-emote="happy"   id="pickHappy"   title="Happy">üôÇ Happy</button>
        <button data-emote="neutral" id="pickNeutral" title="Neutral">üòê Neutral</button>
        <button data-emote="sad"     id="pickSad"     title="Sad">üò¢ Sad</button>
        <button data-emote="angry"   id="pickAngry"   title="Angry">üò† Angry</button>
      </div>
    </section>

    <!-- Notes & Errors -->
    <section class="card" aria-labelledby="notes-title">
      <h2 id="notes-title">3) Status & Errors</h2>
      <ul id="notes" class="muted" style="line-height:1.6">
        <li>Shows error states as human-readable messages.</li>
        <li>Handles network issues, permission denial, invalid files, and model load failures.</li>
        <li>No server calls ‚Äî all inference runs in the browser (with a simple rate-limit).</li>
      </ul>
      <div id="errorBox" class="error hidden" role="alert"></div>
      <div id="okBox" class="good hidden">System is running normally.</div>
    </section>

    <!-- Step 3: Weather selection (initially hidden) -->
    <section class="card hidden" id="weather-section" aria-labelledby="weather-title">
      <h2 id="weather-title">3) Choose Weather</h2>
      <p class="muted">Pick today‚Äôs weather. (Manual selection in this version.)</p>
      <div class="row" style="margin-top:8px">
        <button data-weather="Sunny">‚òÄÔ∏è Sunny</button>
        <button data-weather="Cloudy">‚õÖ Cloudy</button>
        <button data-weather="Rainy">üåßÔ∏è Rainy</button>
      </div>
    </section>

    <!-- Step 4: Final matched card (single) -->
    <section class="card hidden" aria-labelledby="final-title" id="final-section">
      <h2 id="final-title">Final Recommendation</h2>
      <div id="card-grid" style="display:grid;grid-template-columns:1fr;gap:12px;margin-top:12px"></div>
      <div class="row" style="margin-top:12px">
        <button id="btnRestart">Start Over</button>
      </div>
    </section>
  </main>

<script>
  // === 0) Config ===
  // Teachable Machine hosted model URL (must include trailing '/')
  const MODEL_URL = "https://teachablemachine.withgoogle.com/models/adfTD5Yf_/";
  const TOP_K = 3;           // top-k labels
  const LOW_CONF = 0.6;      // low confidence threshold
  const CAM_INFER_MS = 300;  // camera inference interval (ms) ‚Äî simple rate-limit

  // === 1) DOM helpers & refs ===
  const el = (id)=>document.getElementById(id);
  const $status = el('status');
  const $msg = el('msg');
  const $video = el('video');
  const $img = el('img');
  const $canvas = el('canvas');
  const $pred = el('predictions');
  const $guide = el('guidance');
  const $err = el('errorBox');
  const $ok = el('okBox');
  const $progress = el('progress');
  const $progressBox = el('progressBox');

  const $btnCam = el('btnCam');
  const $file = el('file');
  const $btnReset = el('btnReset');
  const $btnNextWeather = el('btnNextWeather');
  const $weatherSection = el('weather-section');
  const $finalSection = el('final-section');
  const $predSection = el('pred-section');
  const $btnRestart = el('btnRestart');

  // === State (steps / selections) ===
  const MOOD_TO_STYLE = { happy:"Active", neutral:"Minimal", sad:"Cozy", angry:"Street" };
  let step = 1;                // 1: input/prediction ‚Üí 2: weather ‚Üí 3: final card
  let selectedEmotion = null;  // 'happy' | 'neutral' | 'sad' | 'angry'
  let selectedStyle = null;    // 'Active' | 'Minimal' | 'Cozy' | 'Street'
  let selectedWeather = null;  // 'Sunny' | 'Cloudy' | 'Rainy'

  // === 2) Global model/camera ===
  let model, maxPredictions;
  let webcamStream = null;
  let inferTimer = null; // reserved for potential setInterval usage
  let lastInfer = 0;

  // Accessibility: announce helper
  function announce(html, cls=""){
    $msg.className = cls || "";
    $msg.innerHTML = html;
    $msg.classList.remove('hidden');
  }
  function setError(e){
    $err.textContent = e; $err.classList.remove('hidden'); $ok.classList.add('hidden');
  }
  function setOk(t="System is running normally."){
    $ok.textContent = t; $ok.classList.remove('hidden'); $err.classList.add('hidden');
  }

  // === 3) Load model ===
  async function loadModel(){
    try{
      if (typeof tmImage === 'undefined') {
        throw new Error('Teachable Machine library (tmImage) is not loaded. Please check your network or CDN blocking.');
      }
      if (!window.isSecureContext && !location.hostname.match(/^localhost|127\.0\.0\.1$/)) {
        console.warn('Insecure context: camera access requires HTTPS or localhost. (Model loading is still possible.)');
      }
      if(!MODEL_URL || !MODEL_URL.startsWith('http')){
        throw new Error('Please set a valid MODEL_URL.');
      }

      $status.textContent = 'Loading model‚Ä¶';
      $progressBox.classList.remove('hidden');

      let p=0; const t = setInterval(()=>{p=Math.min(p+8, 96); $progress.value=p;}, 120);

      const modelURL = MODEL_URL + 'model.json';
      const metadataURL = MODEL_URL + 'metadata.json';
      try{
        const [headModel, headMeta] = await Promise.all([
          fetch(modelURL, { method:'GET' }),
          fetch(metadataURL, { method:'GET' })
        ]);
        if(!headModel.ok) throw new Error('model.json responded with '+headModel.status+'. Please check the URL or public access settings.');
        if(!headMeta.ok) throw new Error('metadata.json responded with '+headMeta.status+'. Please check the URL or public access settings.');
      }catch(pre){
        clearInterval(t); $progress.value=0; $progressBox.classList.add('hidden');
        throw pre;
      }

      model = await tmImage.load(modelURL, metadataURL);
      clearInterval(t); $progress.value = 100; setTimeout(()=>{$progressBox.add('hidden');}, 300);

      maxPredictions = model.getTotalClasses();
      setOk('Model loaded ('+maxPredictions+' classes).');
      $btnCam.disabled = false; 
      $status.textContent = 'Ready. Choose an input to start.';
    }catch(e){
      console.error(e); setError('Failed to load model: '+ e.message);
      $status.textContent = 'Stopped due to an error.';
    }
  }

  // === 4) File upload ===
  $file.addEventListener('change', async (ev)=>{
    try{
      const f = ev.target.files && ev.target.files[0];
      if(!f){announce('No file selected.','muted');return}
      if(!f.type.startsWith('image/')){setError('This is not a valid image file.');return}

      stopCamera();
      $video.classList.add('hidden');
      $img.classList.remove('hidden');
      const url = URL.createObjectURL(f);
      $img.src = url;
      $img.onload = ()=> URL.revokeObjectURL(url);

      await predictOnce($img);
    }catch(e){setError('Error while predicting from file: '+ e.message)}
  });

  // === 5) Camera ===
  async function startCamera(){
    try{
      stopCamera();
      $status.textContent = 'Requesting camera permission‚Ä¶';
      webcamStream = await navigator.mediaDevices.getUserMedia({video:{facingMode:'user'}, audio:false});
      $video.srcObject = webcamStream;
      $video.muted = true;
      $video.setAttribute('playsinline','');
      await $video.play();

      $img.classList.add('hidden');
      $video.classList.remove('hidden');

      if ($video.readyState >= 2) {
        startPredictLoop();
      } else {
        $video.addEventListener('loadeddata', startPredictLoop, { once:true });
      }

      $status.textContent = 'Camera input active‚Ä¶';
      $btnCam.textContent = 'Stop Camera';
      $btnCam.setAttribute('aria-pressed','true');
    }catch(e){
      console.error(e);
      setError('Unable to start camera (permission denied or device not supported).');
    }
  }

  function stopCamera(){
    if(inferTimer){clearInterval(inferTimer); inferTimer=null}
    if(webcamStream){
      webcamStream.getTracks().forEach(t=>t.stop());
      webcamStream = null;
    }
    $btnCam.textContent = 'Start Camera';
    $btnCam.setAttribute('aria-pressed','false');
  }

  // === 5-b) rAF inference loop ===
  function startPredictLoop(){
    if(!model || !$video || !webcamStream) return;
    const loop = (ts) => {
      if(!webcamStream) return;
      if (ts - lastInfer >= CAM_INFER_MS) {
        lastInfer = ts;
        predictOnce($video).catch(console.warn);
      }
      requestAnimationFrame(loop);
    };
    requestAnimationFrame(loop);
  }

  $btnCam.addEventListener('click',()=>{
    if(webcamStream) stopCamera(); else startCamera();
  });

  // Manual emotion selection buttons
  ['pickHappy','pickNeutral','pickSad','pickAngry'].forEach(id=>{
    const elBtn = document.getElementById(id);
    if(!elBtn) return;
    elBtn.addEventListener('click',()=>{
      const m = elBtn.getAttribute('data-emote');
      if(m){ setEmotionAndEnableNext(m); }
    });
  });

  // Next: weather selection
  $btnNextWeather.addEventListener('click',()=>{
    gotoWeatherStep();
  });

  // Weather buttons
  $weatherSection.querySelectorAll('button[data-weather]').forEach(btn=>{
    btn.addEventListener('click',()=>{
      selectedWeather = btn.getAttribute('data-weather');
      showFinalCard();
    });
  });

  // Restart
  $btnRestart.addEventListener('click',()=>{
    selectedEmotion = null; selectedStyle = null; selectedWeather = null; step = 1;
    $predSection.classList.remove('hidden');
    $weatherSection.classList.add('hidden');
    $finalSection.classList.add('hidden');
    $pred.textContent = 'Waiting for results‚Ä¶';
    $guide.textContent = '';
    $btnNextWeather.disabled = true;
    stopCamera();
    $video.classList.add('hidden');
    $img.classList.add('hidden');
    setOk('Restarting from the beginning.');
  });

  // === 6) Reset ===
  $btnReset.addEventListener('click',()=>{
    stopCamera();
    $video.classList.add('hidden');
    $img.src = '';
    $img.classList.add('hidden');
    $pred.textContent = 'Waiting for results‚Ä¶';
    $guide.textContent = '';
    setOk();
    announce('Reset complete.','muted');
  });

  // === 7) Inference ===
  async function predictOnce(sourceEl){
    if(!model){announce('Please load the model first.','muted');return}
    const W=224, H=224;
    $canvas.width=W; $canvas.height=H;
    const ctx=$canvas.getContext('2d');
    ctx.drawImage(sourceEl,0,0,W,H);

    const predictions = await model.predict($canvas);
    const sorted = predictions.sort((a,b)=>b.probability - a.probability).slice(0, TOP_K);

    const lines = sorted.map(p=>{
      const pct = (p.probability*100).toFixed(1);
      return `${p.className.padEnd(12,' ')}  ${pct}%`;
    });
    $pred.textContent = lines.join('\n');

    const best = sorted[0];
    if(best && best.probability < LOW_CONF){
      $guide.innerHTML = 'Low confidence. Try <strong>simplifying the background</strong>, <strong>improving lighting</strong>, and <strong>filling the frame with your face</strong>, then run it again.';
    }else{
      $guide.textContent = '';
    }

    // Map predicted label to one of our target emotions (Happy / Neutral / Sad / Angry)
    if (best) {
      const label = (best.className || '').toLowerCase();
      let emote = null;
      if(label.startsWith('happy') || label.includes('happy')) emote = 'happy';
      else if(label.startsWith('neutral') || label.includes('neutral')) emote = 'neutral';
      else if(label.startsWith('sad') || label.includes('sad')) emote = 'sad';
      else if(label.startsWith('angry') || label.includes('angry')) emote = 'angry';

      if(emote){
        setEmotionAndEnableNext(emote);
      }
    }

    setOk();
  }

  // === 7-b) Emotion / step helpers ===
  function setEmotionAndEnableNext(emote){
    selectedEmotion = emote;
    selectedStyle = MOOD_TO_STYLE[emote] || null;
    $btnNextWeather.disabled = !selectedStyle;
    if(selectedStyle){
      announce(`Emotion: <strong>${emote}</strong> ‚Üí Style: <strong>${selectedStyle}</strong>`, 'muted');
    }
  }

  function gotoWeatherStep(){
    if(!selectedStyle){
      announce('Please select an emotion or finish face detection first.','muted');
      return;
    }
    step = 2;
    $predSection.classList.add('hidden');
    $weatherSection.classList.remove('hidden');
    $finalSection.classList.add('hidden');
  }

  function showFinalCard(){
    if(!selectedStyle || !selectedWeather){
      announce('Style or weather information is missing. Please select again.','muted');
      return;
    }
    const target = RECOMMENDATIONS.find(card=>
      card.mood === selectedStyle && card.weather === selectedWeather
    );
    const list = target ? [target] : [];
    renderCards(list);
    step = 3;
    $predSection.classList.add('hidden');
    $weatherSection.classList.add('hidden');
    $finalSection.classList.remove('hidden');
  }

  // === 8) Keyboard shortcuts ===
  document.addEventListener('keydown',(e)=>{
    if(e.key==='c' || e.key==='C'){ e.preventDefault(); $btnCam.click(); }
    if(e.key==='u' || e.key==='U'){ e.preventDefault(); $file.click(); }
    if(e.key==='r' || e.key==='R'){ e.preventDefault(); $btnReset.click(); }
  });

  // === 9) Network status ===
  function updateOnline(){
    if(navigator.onLine){ setOk('Online ‚Äî model can run.'); }
    else{ setError('Offline ‚Äî the first model load requires an internet connection.'); }
  }
  window.addEventListener('online', updateOnline);
  window.addEventListener('offline', updateOnline);

  // === 10) Init ===
  (async ()=>{
    updateOnline();
    await loadModel();
  })();

  // ====== 11) Card data (text only + hero image path) ======
  const RECOMMENDATIONS = [
    // Active √ó 3
    { id:"active_sunny",  title:"Active √ó Sunny",  mood:"Active",  weather:"Sunny",
      hero:"assets_img/active_sunny.jpg",
      palette_text:"Red / Orange / Yellow (high energy)",
      items:["Cotton T-shirt","Mini skirt","Sneakers"],
      accessories:["Sunglasses","Cap","Beaded bracelet"],
      description:"Bright, free energy that matches a sunny day." },

    { id:"active_cloudy", title:"Active √ó Cloudy", mood:"Active", weather:"Cloudy",
      hero:"assets_img/active_cloudy.jpg",
      palette_text:"Red / Orange / Yellow (slightly toned down)",
      items:["T-shirt + light cardigan","Lightweight pants"],
      accessories:["Bucket hat","Small crossbody bag"],
      description:"Stay active on cloudy days with light layers." },

    { id:"active_rainy",  title:"Active √ó Rainy",  mood:"Active",  weather:"Rainy",
      hero:"assets_img/active_rainy.jpg",
      palette_text:"Red / Orange / Yellow with a neutral outer layer",
      items:["Light rain jacket","Long pants","Water-resistant sneakers"],
      accessories:["Umbrella or bucket hat","Practical backpack"],
      description:"Add a bright inner layer under a rain-proof outer for energy." },

    // Minimal √ó 3
    { id:"minimal_sunny", title:"Minimal √ó Sunny", mood:"Minimal", weather:"Sunny",
      hero:"assets_img/minimal_sunny.jpg",
      palette_text:"Beige / Light Blue / White (clean)",
      items:["Light blue shirt","White pants"],
      accessories:["Mini leather tote","Simple metal watch"],
      description:"Clean, well-organized look with bright tone-on-tone colors." },

    { id:"minimal_cloudy", title:"Minimal √ó Cloudy", mood:"Minimal", weather:"Cloudy",
      hero:"assets_img/minimal_cloudy.jpg",
      palette_text:"Beige / Light Blue / White (balanced)",
      items:["Shirt + cardigan","Chino pants"],
      accessories:["Slim belt","Minimal sneakers"],
      description:"Soft mid-tones to keep a calm and balanced mood on cloudy days." },

    { id:"minimal_rainy", title:"Minimal √ó Rainy", mood:"Minimal", weather:"Rainy",
      hero:"assets_img/minimal_rainy.jpg",
      palette_text:"Beige / Light Blue / White (rain-friendly)",
      items:["Beige trench coat","Shirt","Slacks"],
      accessories:["Mini tote bag","Metal watch"],
      description:"Keep your silhouette clean and simple even on rainy days." },

    // Cozy √ó 3
    { id:"cozy_sunny",   title:"Cozy √ó Sunny",   mood:"Cozy",   weather:"Sunny",
      hero:"assets_img/cozy_sunny.jpg",
      palette_text:"Navy / Black / Gray (lightweight cozy)",
      items:["Light knit top","Relaxed-fit pants"],
      accessories:["Soft light scarf","Canvas bag"],
      description:"Soft knit and gentle tones for a relaxed, cozy mood." },

    { id:"cozy_cloudy",  title:"Cozy √ó Cloudy",  mood:"Cozy",   weather:"Cloudy",
      hero:"assets_img/cozy_cloudy.jpg",
      palette_text:"Navy / Black / Gray (warm)",
      items:["Knit sweater","Coat"],
      accessories:["Scarf","Warm-textured bag"],
      description:"Low-saturation tones and warm textures for comfort and stability." },

    { id:"cozy_rainy",   title:"Cozy √ó Rainy",   mood:"Cozy",   weather:"Rainy",
      hero:"assets_img/cozy_rainy.jpg",
      palette_text:"Navy / Black / Gray (weather-ready)",
      items:["Hooded coat","Dark jeans"],
      accessories:["Water-resistant boots (Chelsea)","Umbrella"],
      description:"Combine warmth and water protection to stay cozy in the rain." },

    // Street √ó 3
    { id:"street_sunny", title:"Street √ó Sunny", mood:"Street", weather:"Sunny",
      hero:"assets_img/street_sunny.jpg",
      palette_text:"Purple / Brown / Green (light mix)",
      items:["Graphic T-shirt","Cargo shorts"],
      accessories:["Cap","Chain bracelet"],
      description:"Lightweight pieces with street-style color points for sunny days." },

    { id:"street_cloudy", title:"Street √ó Cloudy", mood:"Street", weather:"Cloudy",
      hero:"assets_img/street_cloudy.jpg",
      palette_text:"Purple / Brown / Green (muted)",
      items:["Oversized hoodie","Wide-leg pants"],
      accessories:["Chunky sneakers","Crossbody bag"],
      description:"Stand out in gray weather with bold silhouettes and details." },

    { id:"street_rainy", title:"Street √ó Rainy", mood:"Street", weather:"Rainy",
      hero:"assets_img/street_rainy.jpg",
      palette_text:"Purple / Brown / Green (tech mix)",
      items:["Rain jacket","Cargo pants"],
      accessories:["Water-repellent bucket hat","High-grip sneakers"],
      description:"Techwear-inspired pieces that balance strong style and practicality." }
  ];

  // ====== 12) Card rendering ======
  const grid = document.getElementById('card-grid');
  function renderCards(list){
    if(!grid || !Array.isArray(list)) return;
    grid.style.gridTemplateColumns = window.innerWidth>=960 ? '1fr 1fr' : '1fr';
    grid.innerHTML='';
    list.forEach(card=>{
      const el=document.createElement('article');
      el.className='rec-card';
      el.style.cssText='border:1px solid #eee;border-radius:12px;overflow:hidden;background:#fff;box-shadow:0 6px 20px rgba(0,0,0,.06)';
      el.innerHTML = `
        <div style="aspect-ratio:4/3;background:#f0f0f0">
          <img src="${card.hero||'assets_img/placeholder.jpg'}" alt="${card.title}" style="width:100%;height:100%;object-fit:cover">
        </div>
        <div style="padding:12px">
          <h3 style="margin:0 0 6px;font-size:18px">${card.title}</h3>
          <p style="margin:0 0 6px;color:#666">
            <strong>${card.mood}</strong> ¬∑ ${card.weather} ¬∑
            <span style="background:#f5f5f5;border-radius:8px;padding:2px 6px">${(card.palette_text||'')}</span>
          </p>
          <div style="display:flex;gap:12px;align-items:flex-start;flex-wrap:wrap">
            <div>
              <div style="font-weight:600;margin-bottom:4px">Items</div>
              <ul style="margin:0;padding-left:18px">${(card.items||[]).map(i=>`<li>${i}</li>`).join('')}</ul>
            </div>
            <div>
              <div style="font-weight:600;margin-bottom:4px">Accessories</div>
              <ul style="margin:0;padding-left:18px">${(card.accessories||[]).map(a=>`<li>${a}</li>`).join('')}</ul>
            </div>
          </div>
          <p style="margin:8px 0 0;color:#444">${card.description||''}</p>
        </div>`;
      grid.appendChild(el);
    });
  }

  // (Optional) handle layout on resize later if needed
  window.addEventListener('resize',()=>{
    // If you cache the last recommendation list, you can re-render here.
  });
</script>
</body>
</html>

